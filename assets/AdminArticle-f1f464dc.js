import{S as c}from"./sweetalert2.all-651b2c6a.js";import{p as C,M as w}from"./PaginationVue-9a868aa4.js";import{D as P}from"./DeleteModal-440e5e8d.js";import{C as V}from"./ckeditor-2fdb1659.js";import{_ as U,r as g,o,c as n,b,a as t,F as f,n as v,i as m,v as h,p as D,l as y,t as A}from"./index-695e9cad.js";const{VITE_APP_URL:p,VITE_APP_PATH:u}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"winter_",BASE_URL:"/vue-hw-7/",MODE:"production",DEV:!1,PROD:!0},T={data(){return{isNew:!0,isLoading:!1,page:{},articles:{},tempArticle:{tag:[],isPublic:!1},create_at:new Date().getTime()/1e3,articleModal:"",delArticleModal:"",editor:V,editorData:"<p>Hello world!!</p>",editorConfig:{toolbar:["heading","|","bold","italic","link"],dataProcessor:{writer:{enter:"<br>"}}}}},methods:{checkLogin(){const l=`${p}/api/user/check`;this.$http.post(l).then(()=>{this.getArticles()}).catch(e=>{c.fire({icon:"error",title:e.response.data.message}),window.location="login.html"})},getArticles(l=1){this.isLoading=!0;const e=`${p}/api/${u}/admin/articles/?page=${l}`;this.$http.get(e).then(r=>{this.isLoading=!1,this.articles=r.data.articles,this.page=r.data.pagination}).catch(r=>{this.isLoading=!1,c.fire({icon:"error",title:r.response.data.message})})},getArticle(l){this.isLoading=!0;const e=`${p}/api/${u}/admin/article/${l}`;this.$http.get(e).then(r=>{this.isLoading=!1,this.openModal("edit",r.data.article)}).catch(r=>{this.isLoading=!1,c.fire({icon:"error",title:r.response.data.message})})},updateArticle(){this.isLoading=!0;let l=`${p}/api/${u}/admin/article`;this.isNew?this.$http.post(l,{data:this.tempArticle}).then(e=>{this.articleModal.hide(),c.fire({icon:"success",title:e.data.message,showConfirmButton:!1,timer:1500}),this.getArticles(),this.isLoading=!1}).catch(e=>{this.isLoading=!1,c.fire({icon:"error",title:e.response.data.message})}):(l=`${p}/api/${u}/admin/article/${this.tempArticle.id}`,this.$http.put(l,{data:this.tempArticle}).then(e=>{this.articleModal.hide(),c.fire({icon:"success",title:e.data.message,showConfirmButton:!1,timer:1500}),this.getArticles(),this.isLoading=!1}).catch(e=>{this.isLoading=!1,c.fire({icon:"error",title:e.response.data.message})}))},deleteArticle(){this.isLoading=!0;const l=`${p}/api/${u}/admin/article/${this.tempArticle.id}`;this.$http.delete(l).then(e=>{this.delArticleModal.hide(),c.fire({icon:"success",title:e.data.message,showConfirmButton:!1,timer:1500}),this.getArticles(),this.isLoading=!1}).catch(e=>{this.isLoading=!1,c.fire({icon:"error",title:e.response.data.message})})},openModal(l,e){this.tempArticle={...e},l==="new"?(this.tempArticle={create_at:new Date().getTime()/1e3,tag:[],isPublic:!1},this.isNew=!0,this.articleModal.show()):l==="edit"?(this.isNew=!1,this.articleModal.show()):l==="delete"&&this.delArticleModal.show()}},components:{pagination:C,DeleteModal:P},watch:{tempArticle(){const l=new Date(this.tempArticle.create_at*1e3).toISOString().split("T");[this.create_at]=l,this.tempArticle.tag||(this.tempArticle.tag=[])},create_at(){this.tempArticle.create_at=Math.floor(new Date(this.create_at)/1e3)}},mounted(){this.isLoading=!0,this.articleModal=new w(document.getElementById("articleModal"),{keyboard:!1}),this.delArticleModal=new w(document.getElementById("delModal"),{keyboard:!1});const l=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=l,this.checkLogin()}},E={class:"container"},B={class:"mt-4 d-flex justify-content-between align-items-end"},N=t("h2",{class:"mt-4"},"文章",-1),I={class:"table mt-4"},S=t("thead",null,[t("tr",null,[t("th",{style:{width:"100px"}},"建立時間"),t("th",{style:{width:"200px"}},"標題"),t("th",{style:{width:"200px"}},"標籤"),t("th",null,"描述"),t("th",{style:{width:"100px"}},"文章狀態"),t("th",{style:{width:"120px"}},"編輯")])],-1),R={key:0,class:"text-success"},H={key:1},O={class:"btn-group"},F=["onClick"],j=["onClick"],z={id:"articleModal",ref:"articleModal",class:"modal fade",tabindex:"-1","aria-labelledby":"articleModalLabel","aria-hidden":"true"},Z={class:"modal-dialog modal-xl modal-dialog-scrollable"},q={class:"modal-content border-0"},G={class:"modal-header bg-dark text-white"},J={id:"articleModalLabel",class:"modal-title"},K={key:0},Q={key:1},W=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),X={class:"modal-body"},Y={class:"row"},$={class:"col-sm-4"},tt={class:"mb-3"},et=t("label",{for:"title"},"標題",-1),it={class:"mb-3"},st=t("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),lt=["src"],ot={class:"mb-3"},nt=t("label",{for:"author"},"作者",-1),at={class:"mb-3"},rt=t("label",{for:"create_at"},"建立日期",-1),ct={class:"mb-3"},dt={class:"form-check"},mt=t("label",{class:"form-check-label",for:"isPublic"}," 是否發佈 ",-1),ht={class:"col-sm-8"},pt={class:"mb-3"},ut=t("label",{for:"tag",class:"form-label"},"標籤",-1),_t={key:0,class:"row gx-1 mb-3"},gt={class:"input-group input-group-sm"},bt=["onUpdate:modelValue"],ft=["onClick"],At=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-x-lg",viewBox:"0 0 16 16"},[t("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"})],-1),vt=[At],wt={key:0,class:"col-md-2 mb-1"},yt={class:"mb-3"},kt=t("label",{for:"description",class:"form-label"},"文章描述",-1),Lt={class:"mb-3"},Mt={class:"modal-footer"},xt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Ct(l,e,r,Pt,i,a){const k=g("loadingVue"),L=g("ckeditor"),M=g("DeleteModal"),x=g("pagination");return o(),n(f,null,[b(k,{active:i.isLoading,"onUpdate:active":e[0]||(e[0]=s=>i.isLoading=s)},null,8,["active"]),t("div",E,[t("div",B,[N,t("div",null,[t("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=s=>a.openModal("new",{}))}," 新增文章 ")])])]),t("table",I,[S,t("tbody",null,[(o(!0),n(f,null,v(i.articles,s=>(o(),n("tr",{key:s.id},[t("td",null,A(l.$filters.date(s.create_at)),1),t("td",null,A(s.title),1),t("td",null,[(o(!0),n(f,null,v(s.tag,(d,_)=>(o(),n("span",{class:"badge bg-info me-1",key:_+"tag"},A(d),1))),128))]),t("td",null,A(s.description),1),t("td",null,[s.isPublic?(o(),n("span",R,"已發佈")):(o(),n("span",H,"未發佈"))]),t("td",null,[t("div",O,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:d=>a.getArticle(s.id)}," 編輯 ",8,F),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:d=>a.openModal("delete",s)}," 刪除 ",8,j)])])]))),128))])]),t("div",z,[t("div",Z,[t("div",q,[t("div",G,[t("h5",J,[i.isNew?(o(),n("span",K,"新增文章")):(o(),n("span",Q,"編輯文章"))]),W]),t("div",X,[t("div",Y,[t("div",$,[t("div",tt,[et,m(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[2]||(e[2]=s=>i.tempArticle.title=s),placeholder:"請輸入標題"},null,512),[[h,i.tempArticle.title]])]),t("div",it,[st,m(t("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":e[3]||(e[3]=s=>i.tempArticle.imageUrl=s),placeholder:"請輸入圖片連結"},null,512),[[h,i.tempArticle.imageUrl]]),t("img",{class:"img-fluid",src:i.tempArticle.imageUrl,alt:""},null,8,lt)]),t("div",ot,[nt,m(t("input",{type:"text",class:"form-control",id:"author","onUpdate:modelValue":e[4]||(e[4]=s=>i.tempArticle.author=s),placeholder:"請輸入作者"},null,512),[[h,i.tempArticle.author]])]),t("div",at,[rt,m(t("input",{type:"date",class:"form-control",id:"create_at","onUpdate:modelValue":e[5]||(e[5]=s=>i.create_at=s)},null,512),[[h,i.create_at]])]),t("div",ct,[t("div",dt,[m(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=s=>i.tempArticle.isPublic=s),id:"isPublic"},null,512),[[D,i.tempArticle.isPublic]]),mt])])]),t("div",ht,[t("div",pt,[ut,i.tempArticle.tag?(o(),n("div",_t,[(o(!0),n(f,null,v(i.tempArticle.tag,(s,d)=>(o(),n("div",{class:"col-md-2 mb-1",key:d},[t("div",gt,[m(t("input",{type:"text",class:"form-control form-control",id:"tag","onUpdate:modelValue":_=>i.tempArticle.tag[d]=_,placeholder:"請輸入標籤"},null,8,bt),[[h,i.tempArticle.tag[d]]]),t("button",{type:"button",class:"btn btn-outline-danger",onClick:_=>i.tempArticle.tag.splice(d,1)},vt,8,ft)])]))),128)),i.tempArticle.tag[i.tempArticle.tag.length-1]||!i.tempArticle.tag.length?(o(),n("div",wt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",type:"button",onClick:e[7]||(e[7]=s=>i.tempArticle.tag.push(""))}," 新增標籤 ")])):y("",!0)])):y("",!0)]),t("div",yt,[kt,m(t("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":e[8]||(e[8]=s=>i.tempArticle.description=s),placeholder:"請輸入文章描述"},null,512),[[h,i.tempArticle.description]])]),t("div",Lt,[b(L,{editor:i.editor,config:i.editorConfig,modelValue:i.tempArticle.content,"onUpdate:modelValue":e[9]||(e[9]=s=>i.tempArticle.content=s)},null,8,["editor","config","modelValue"])])])])]),t("div",Mt,[xt,i.isNew?(o(),n("button",{key:0,type:"button",class:"btn btn-primary",onClick:e[10]||(e[10]=(...s)=>a.updateArticle&&a.updateArticle(...s))}," 新增文章 ")):(o(),n("button",{key:1,type:"button",class:"btn btn-primary",onClick:e[11]||(e[11]=(...s)=>a.updateArticle&&a.updateArticle(...s))}," 更新文章 "))])])])],512),b(M,{item:i.tempArticle,"delete-item":a.deleteArticle},null,8,["item","delete-item"]),b(x,{pages:i.page,"get-products":a.getArticles,onChangePage:a.getArticles},null,8,["pages","get-products","onChangePage"])],64)}const Bt=U(T,[["render",Ct]]);export{Bt as default};
