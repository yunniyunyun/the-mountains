import{S as c}from"./sweetalert2.all-44e3db16.js";import{M as C}from"./bootstrap.esm-434bcbc7.js";import{p as V}from"./PaginationVue-a41f2645.js";import{D as L}from"./DeleteModal-6b220abf.js";import{_ as D,r as p,o as d,c as u,b as a,a as e,F as w,B as P,w as x,t as g,E as b,G as E,L as T}from"./index-47d87b33.js";const{VITE_APP_URL:m,VITE_APP_PATH:f}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"winter_",BASE_URL:"/the-mountains/",MODE:"production",DEV:!1,PROD:!0},A={data(){return{isLoading:!1,isNew:!1,coupons:{},page:{},tempCoupon:{is_enabled:0},due_date:"",couponModal:"",delCouponModal:"",state:""}},methods:{checkLogin(){const o=`${m}/api/user/check`;this.$http.post(o).then(()=>{this.getCoupons()}).catch(t=>{c.fire({icon:"error",title:t.response.data.message}),window.location="login.html"})},getCoupons(o=1){this.isLoading=!0;const t=`${m}/api/${f}/admin/coupons/?page=${o}`;this.$http.get(t).then(r=>{this.isLoading=!1,this.coupons=r.data.coupons,this.page=r.data.pagination}).catch(r=>{this.isLoading=!1,c.fire({icon:"error",title:r.response.data.message})})},updateCoupon(){this.isLoading=!0;let o=`${m}/api/${f}/admin/coupon`;this.isNew?this.$http.post(o,{data:this.tempCoupon}).then(t=>{this.couponModal.hide(),c.fire({icon:"success",title:t.data.message,showConfirmButton:!1,timer:1500}),this.getCoupons(),this.isLoading=!1}).catch(t=>{this.isLoading=!1,c.fire({icon:"error",title:t.response.data.message})}):(o=`${m}/api/${f}/admin/coupon/${this.tempCoupon.id}`,this.$http.put(o,{data:this.tempCoupon}).then(t=>{this.couponModal.hide(),c.fire({icon:"success",title:t.data.message,showConfirmButton:!1,timer:1500}),this.getCoupons(),this.isLoading=!1}).catch(t=>{this.isLoading=!1,c.fire({icon:"error",title:t.response.data.message})}))},deleteCoupon(){this.isLoading=!0;const o=`${m}/api/${f}/admin/coupon/${this.tempCoupon.id}`;this.$http.delete(o).then(t=>{this.delCouponModal.hide(),c.fire({icon:"success",title:t.data.message,showConfirmButton:!1,timer:1500}),this.getCoupons(),this.isLoading=!1}).catch(t=>{this.isLoading=!1,c.fire({icon:"error",title:t.response.data.message})})},openModal(o,t){o==="new"?(this.tempCoupon={due_date:new Date().getTime()/1e3,is_enabled:0},this.due_date="",this.isNew=!0,this.couponModal.show()):o==="edit"?(this.tempCoupon={...t},this.isNew=!1,this.couponModal.show()):o==="delete"&&(this.tempCoupon={...t},this.delCouponModal.show())},isPercentage(o){return o?o>100?"折扣不可大於100%":o<0?"折扣不可為負值":!0:"此為必填"},isDate(o){const t=new Date().getTime()/1e3,r=new Date(t*1e3).toISOString().split("T");return o<r[0]?"無效時間":!0}},components:{pagination:V,DeleteModal:L},watch:{tempCoupon(){const o=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=o},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mounted(){this.isLoading=!0,this.couponModal=new C(document.getElementById("couponModal"),{keyboard:!1}),this.delCouponModal=new C(document.getElementById("delModal"),{keyboard:!1});const o=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=o,this.checkLogin()}},B={class:"container"},S={class:"mt-4 d-flex justify-content-between align-items-end"},U=e("h2",{class:"mt-4"},"優惠券",-1),I={class:"table mt-4"},N=e("thead",null,[e("tr",null,[e("th",{width:"150"}," 名稱 "),e("th",{width:"220"}," 使用期限 "),e("th",{width:"100"}," 折扣百分比 "),e("th",{width:"120"}," 優惠券狀態 "),e("th",{width:"120"}," 編輯 ")])],-1),F={key:0,class:"text-success"},O={key:1,class:"text-muted"},R={class:"btn-group"},q=["onClick"],z=["onClick"],H={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},j={class:"modal-dialog modal-dialog-scrollable"},G={class:"modal-content border-0"},J={class:"modal-header bg-dark text-white"},K={id:"couponModalLabel",class:"modal-title"},Q={key:0},W={key:1},X=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Y={class:"modal-body"},Z={class:"mb-3"},$=e("label",{for:"title"},"標題",-1),ee={class:"mb-3"},te=e("label",{for:"coupon_code"},"優惠碼",-1),oe={class:"mb-3"},se=e("label",{for:"due_date"},"到期日",-1),ne={class:"mb-3"},ie=e("label",{for:"price"},"折扣百分比",-1),le={class:"mb-3"},ae={class:"form-check"},de=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),ue={class:"modal-footer"},ce=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function re(o,t,r,pe,s,l){const v=p("loadingVue"),h=p("VField"),_=p("ErrorMessage"),k=p("VForm"),y=p("DeleteModal"),M=p("pagination");return d(),u(w,null,[a(v,{active:s.isLoading,"onUpdate:active":t[0]||(t[0]=n=>s.isLoading=n)},null,8,["active"]),e("div",B,[e("div",S,[U,e("div",null,[e("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=n=>l.openModal("new",s.tempCoupon))}," 新增優惠券 ")])])]),e("table",I,[N,e("tbody",null,[(d(!0),u(w,null,P(s.coupons,n=>(d(),u("tr",{key:n.id},[e("td",null,g(n.title),1),e("td",null,g(o.$filters.date(n.due_date)),1),e("td",null,g(n.percent)+"% ",1),e("td",null,[n.is_enabled===1?(d(),u("span",F,"啟用")):(d(),u("span",O,"未啟用"))]),e("td",null,[e("div",R,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:i=>l.openModal("edit",n)}," 編輯 ",8,q),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>l.openModal("delete",n)}," 刪除 ",8,z)])])]))),128))])]),e("div",H,[a(k,{onSubmit:l.updateCoupon},{default:x(({errors:n})=>[e("div",j,[e("div",G,[e("div",J,[e("h5",K,[s.isNew?(d(),u("span",Q,"新增優惠券")):(d(),u("span",W,"編輯優惠券"))]),X]),e("div",Y,[e("div",Z,[$,a(h,{name:"title",type:"text",class:b(["form-control",{"is-invalid":n.title}]),id:"title",modelValue:s.tempCoupon.title,"onUpdate:modelValue":t[2]||(t[2]=i=>s.tempCoupon.title=i),rules:"required",placeholder:"請輸入標題"},null,8,["modelValue","class"]),a(_,{name:"title",class:"invalid-feedback"})]),e("div",ee,[te,a(h,{name:"coupon_code",type:"text",class:b(["form-control",{"is-invalid":n.coupon_code}]),id:"coupon_code",rules:"required",modelValue:s.tempCoupon.code,"onUpdate:modelValue":t[3]||(t[3]=i=>s.tempCoupon.code=i),placeholder:"請輸入優惠碼"},null,8,["class","modelValue"]),a(_,{name:"coupon_code",class:"invalid-feedback"})]),e("div",oe,[se,a(h,{name:"due_date",type:"date",class:b(["form-control",{"is-invalid":n.due_date}]),id:"due_date",rules:l.isDate,modelValue:s.due_date,"onUpdate:modelValue":t[4]||(t[4]=i=>s.due_date=i)},null,8,["rules","class","modelValue"]),a(_,{name:"due_date",class:"invalid-feedback"})]),e("div",ne,[ie,a(h,{name:"price",type:"number",class:b(["form-control",{"is-invalid":n.price}]),id:"price",rules:l.isPercentage,modelValue:s.tempCoupon.percent,"onUpdate:modelValue":t[5]||(t[5]=i=>s.tempCoupon.percent=i),modelModifiers:{number:!0},placeholder:"請輸入折扣百分比"},null,8,["rules","class","modelValue"]),a(_,{name:"price",class:"invalid-feedback"})]),e("div",le,[e("div",ae,[E(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[6]||(t[6]=i=>s.tempCoupon.is_enabled=i),id:"is_enabled"},null,512),[[T,s.tempCoupon.is_enabled]]),de])])]),e("div",ue,[ce,s.isNew?(d(),u("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[7]||(t[7]=(...i)=>l.updateCoupon&&l.updateCoupon(...i))}," 新增優惠券 ")):(d(),u("button",{key:1,type:"button",class:"btn btn-primary",onClick:t[8]||(t[8]=(...i)=>l.updateCoupon&&l.updateCoupon(...i))}," 更新優惠券 "))])])])]),_:1},8,["onSubmit"])],512),a(y,{item:s.tempCoupon,"delete-item":l.deleteCoupon},null,8,["item","delete-item"]),a(M,{pages:s.page,"get-products":l.getCoupons,onChangePage:l.getCoupons},null,8,["pages","get-products","onChangePage"])],64)}const ge=D(A,[["render",re]]);export{ge as default};
