import{S as a}from"./sweetalert2.all-00cb6fe9.js";import{p as k,M as g}from"./PaginationVue-21b2184e.js";import{D as M}from"./DeleteModal-2ee4ccad.js";import{_ as L,r as m,o as l,c as d,b as _,d as e,F as f,f as x,i as p,j as r,l as V,t as b}from"./index-2073be87.js";const{VITE_APP_URL:c,VITE_APP_PATH:h}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"winter_",BASE_URL:"/vue-hw-7/",MODE:"production",DEV:!1,PROD:!0},P={data(){return{isLoading:!1,isNew:!1,coupons:{},page:{},tempCoupon:{is_enabled:0},due_date:"",couponModal:"",delCouponModal:""}},methods:{checkLogin(){const s=`${c}/api/user/check`;this.$http.post(s).then(()=>{this.getCoupons()}).catch(t=>{a.fire({icon:"error",title:t.response.data.message}),window.location="login.html"})},getCoupons(s=1){this.isLoading=!0;const t=`${c}/api/${h}/admin/coupons/?page=${s}`;this.$http.get(t).then(u=>{this.isLoading=!1,this.coupons=u.data.coupons,this.page=u.data.pagination}).catch(u=>{this.isLoading=!1,a.fire({icon:"error",title:u.response.data.message})})},updateCoupon(){this.isLoading=!0;let s=`${c}/api/${h}/admin/coupon`;this.isNew?this.$http.post(s,{data:this.tempCoupon}).then(t=>{this.couponModal.hide(),a.fire({icon:"success",title:t.data.message,showConfirmButton:!1,timer:1500}),this.getCoupons(),this.isLoading=!1}).catch(t=>{this.isLoading=!1,a.fire({icon:"error",title:t.response.data.message})}):(s=`${c}/api/${h}/admin/coupon/${this.tempCoupon.id}`,this.$http.put(s,{data:this.tempCoupon}).then(t=>{this.couponModal.hide(),a.fire({icon:"success",title:t.data.message,showConfirmButton:!1,timer:1500}),this.getCoupons(),this.isLoading=!1}).catch(t=>{this.isLoading=!1,a.fire({icon:"error",title:t.response.data.message})}))},deleteCoupon(){this.isLoading=!0;const s=`${c}/api/${h}/admin/coupon/${this.tempCoupon.id}`;this.$http.delete(s).then(t=>{this.delCouponModal.hide(),a.fire({icon:"success",title:t.data.message,showConfirmButton:!1,timer:1500}),this.getCoupons(),this.isLoading=!1}).catch(t=>{this.isLoading=!1,a.fire({icon:"error",title:t.response.data.message})})},openModal(s,t){s==="new"?(this.tempCoupon={due_date:new Date().getTime()/1e3,is_enabled:0},this.due_date="",this.isNew=!0,this.couponModal.show()):s==="edit"?(this.tempCoupon={...t},this.isNew=!1,this.couponModal.show()):s==="delete"&&(this.tempCoupon={...t},this.delCouponModal.show())}},components:{pagination:k,DeleteModal:M},watch:{tempCoupon(){const s=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=s},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mounted(){this.isLoading=!0,this.couponModal=new g(document.getElementById("couponModal"),{keyboard:!1}),this.delCouponModal=new g(document.getElementById("delModal"),{keyboard:!1});const s=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=s,this.checkLogin()}},D={class:"container"},T={class:"mt-4 d-flex justify-content-between align-items-end"},A=e("h2",{class:"mt-4"},"優惠券",-1),E={class:"table mt-4"},B=e("thead",null,[e("tr",null,[e("th",{width:"150"}," 名稱 "),e("th",{width:"220"}," 使用期限 "),e("th",{width:"100"}," 折扣百分比 "),e("th",{width:"120"}," 優惠券狀態 "),e("th",{width:"120"}," 編輯 ")])],-1),U={key:0,class:"text-success"},N={key:1,class:"text-muted"},I={class:"btn-group"},S=["onClick"],R=["onClick"],O={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},j={class:"modal-dialog modal-dialog-scrollable"},F={class:"modal-content border-0"},H={class:"modal-header bg-dark text-white"},z={id:"couponModalLabel",class:"modal-title"},$={key:0},q={key:1},G=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),J={class:"modal-body"},K={class:"mb-3"},Q=e("label",{for:"title"},"標題",-1),W={class:"mb-3"},X=e("label",{for:"coupon_code"},"優惠碼",-1),Y={class:"mb-3"},Z=e("label",{for:"due_date"},"到期日",-1),ee={class:"mb-3"},te=e("label",{for:"price"},"折扣百分比",-1),oe={class:"mb-3"},se={class:"form-check"},ne=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),ie={class:"modal-footer"},le=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function de(s,t,u,ae,n,i){const C=m("loadingVue"),w=m("DeleteModal"),v=m("pagination");return l(),d(f,null,[_(C,{active:n.isLoading,"onUpdate:active":t[0]||(t[0]=o=>n.isLoading=o)},null,8,["active"]),e("div",D,[e("div",T,[A,e("div",null,[e("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=o=>i.openModal("new",n.tempCoupon))}," 新增優惠券 ")])])]),e("table",E,[B,e("tbody",null,[(l(!0),d(f,null,x(n.coupons,o=>(l(),d("tr",{key:o.id},[e("td",null,b(o.title),1),e("td",null,b(s.$filters.date(o.due_date)),1),e("td",null,b(o.percent)+"% ",1),e("td",null,[o.is_enabled===1?(l(),d("span",U,"啟用")):(l(),d("span",N,"未啟用"))]),e("td",null,[e("div",I,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:y=>i.openModal("edit",o)}," 編輯 ",8,S),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:y=>i.openModal("delete",o)}," 刪除 ",8,R)])])]))),128))])]),e("div",O,[e("div",j,[e("div",F,[e("div",H,[e("h5",z,[n.isNew?(l(),d("span",$,"新增優惠券")):(l(),d("span",q,"編輯優惠券"))]),G]),e("div",J,[e("div",K,[Q,p(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[2]||(t[2]=o=>n.tempCoupon.title=o),placeholder:"請輸入標題"},null,512),[[r,n.tempCoupon.title]])]),e("div",W,[X,p(e("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[3]||(t[3]=o=>n.tempCoupon.code=o),placeholder:"請輸入優惠碼"},null,512),[[r,n.tempCoupon.code]])]),e("div",Y,[Z,p(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[4]||(t[4]=o=>n.due_date=o)},null,512),[[r,n.due_date]])]),e("div",ee,[te,p(e("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":t[5]||(t[5]=o=>n.tempCoupon.percent=o),placeholder:"請輸入折扣百分比"},null,512),[[r,n.tempCoupon.percent,void 0,{number:!0}]])]),e("div",oe,[e("div",se,[p(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[6]||(t[6]=o=>n.tempCoupon.is_enabled=o),id:"is_enabled"},null,512),[[V,n.tempCoupon.is_enabled]]),ne])])]),e("div",ie,[le,n.isNew?(l(),d("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[7]||(t[7]=(...o)=>i.updateCoupon&&i.updateCoupon(...o))}," 新增優惠券 ")):(l(),d("button",{key:1,type:"button",class:"btn btn-primary",onClick:t[8]||(t[8]=(...o)=>i.updateCoupon&&i.updateCoupon(...o))}," 更新優惠券 "))])])])],512),_(w,{item:n.tempCoupon,"delete-item":i.deleteCoupon},null,8,["item","delete-item"]),_(v,{pages:n.page,"get-products":i.getCoupons,onChangePage:i.getCoupons},null,8,["pages","get-products","onChangePage"])],64)}const he=L(P,[["render",de]]);export{he as default};
